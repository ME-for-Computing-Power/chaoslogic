# 输出级模块验证计划

## 1. 概述
本验证计划针对输出级模块(`output_stage`)，验证其将128位格雷码数据分发到8个通道的功能正确性。测试平台通过实时比对DUT与参考模型输出确保功能一致性，特别关注通道有效性控制、数据分发和CRC校验逻辑。

## 2. 验证目标
- 验证复位后初始状态
- 验证通道有效性信号(`data_vld_chX`)生成逻辑
- 验证数据分发(`data_out_chX`)正确性
- 验证CRC校验信号(`crc_valid`)生成
- 验证模块对边界条件和随机输入的鲁棒性
- 验证时钟域同步功能

## 3. 测试用例

| 测试用例 | 描述 | 输入配置 | 检查点 | 预期结果 |
|----------|------|----------|--------|----------|
| **复位测试** | 复位信号有效性验证 | `rst_n=0` → `rst_n=1` | 所有输出信号 | 复位后所有输出应为初始状态 |
| **全零输入测试** | 全零数据输入 | `data_gray=128'h0` | 通道输出数据 | 所有通道输出0 |
| **全一输入测试** | 全1数据输入 | `data_gray=128'hFFFF...` | 通道输出数据 | 所有通道输出1 |
| **交替模式测试(AA)** | 0xAA交替模式 | `data_gray=128'hAAAA...` | 通道输出数据 | 通道输出0/1交替 |
| **交替模式测试(55)** | 0x55交替模式 | `data_gray=128'h5555...` | 通道输出数据 | 通道输出1/0交替 |
| **随机数据测试** | 随机数据输入 | `data_gray={$random,...}` | 所有输出信号 | DUT与参考模型一致 |
| **通道有效性测试** | 通道使能信号组合 | `vld_ch`遍历0-255 | 通道有效信号 | 有效信号与vld_ch匹配 |
| **数据计数边界测试** | 数据计数边界值 | `data_count=0,127,65535` | CRC校验信号 | 边界值处理正确 |
| **混合场景测试** | 随机数据+随机vld_ch | 随机组合所有输入 | 所有输出信号 | 功能一致性 |

## 4. 信号说明

### 输入信号
| 信号 | 位宽 | 描述 |
|------|------|------|
| `rst_n` | 1位 | 异步低有效复位 |
| `clk_out16x` | 1位 | 100MHz时钟(周期10ns) |
| `data_gray` | 128位 | 格雷码格式输入数据 |
| `vld_ch` | 8位 | 通道有效控制(每比特对应一个通道) |
| `data_count` | 16位 | 数据计数 |

### 输出信号
| 信号 | 位宽 | 描述 |
|------|------|------|
| `data_out_chX` | 1位×8 | 通道X输出数据 |
| `data_vld_chX` | 1位×8 | 通道X有效信号 |
| `crc_valid` | 1位 | CRC校验有效信号 |

## 5. 检查机制

### 实时比对
在`clk_out16x`下降沿检查：
1. **通道有效信号**：比较所有8个`data_vld_chX`
2. **通道数据信号**：当通道有效时比较`data_out_chX`
3. **CRC校验信号**：比较`crc_valid`

### 错误处理
- 检测到差异立即报告：
  - 错误类型和通道号
  - 当前仿真时间
  - DUT输出值
  - 参考模型输出值
- 错误计数器累计错误数量
- 超过10个错误时终止仿真

### 信号分组
```verilog
// 通道有效信号分组
reg [7:0] dut_data_vld = {ch8, ch7, ch6, ch5, ch4, ch3, ch2, ch1};
reg [7:0] ref_data_vld = {ref_ch8, ..., ref_ch1};

// 通道数据信号分组
reg [7:0] dut_data_out = {ch8, ch7, ch6, ch5, ch4, ch3, ch2, ch1};
reg [7:0] ref_data_out = {ref_ch8, ..., ref_ch1};
```

## 6. 测试激励生成

| 激励类型 | 生成方式 | 测试重点 |
|----------|----------|----------|
| 复位信号 | 初始复位100ns | 复位功能 |
| 时钟信号 | 100MHz(always #5) | 时序逻辑 |
| 通道使能 | `vld_ch = $urandom_range(0,255)` | 通道组合 |
| 数据计数 | `0`,`127`,`65535`及随机值 | 边界处理 |
| 格雷码数据 | 全0/全1/AA/55/随机 | 数据分发 |

## 7. 通过标准
1. 完成1000次随机测试迭代
2. 错误计数器`error_count=0`
3. 显示"Test Complete. Errors found: 0"消息
4. 波形文件完整记录关键测试场景

## 8. 风险分析

| 风险点 | 严重性 | 缓解措施 |
|--------|--------|----------|
| 通道间串扰 | 高 | 增加交替模式测试 |
| CRC校验逻辑错误 | 高 | 边界数据计数测试 |
| 复位状态残留 | 中 | 延长复位时间(100ns) |
| 时钟域问题 | 高 | 随机时钟间隔测试(1-10周期) |
| 通道映射错误 | 高 | 通道遍历测试 |

## 9. 测试指标
- **功能覆盖率**：通道组合、数据模式、计数边界
- **错误检测率**：实时检测并报告差异
- **测试效率**：1000次迭代覆盖典型场景
- **终止条件**：错误>10时自动终止

## 10. 交付物
1. 验证报告（包含通过率统计）
2. 覆盖率报告