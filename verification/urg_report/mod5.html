<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="Author" content="<username>"> <meta name="GENERATOR" content="urg/version [en] (platform name) [urg]">
<title>Unified Coverage Report :: Module :: tb_frame_detector</title>
<link type="text/css" rel="stylesheet" href="css/.urg.css">
<link type="text/css" rel="stylesheet" href="css/.layout.css">
<link type="text/css" rel="stylesheet" href="css/.breadcrumb.css">
<script type="text/javascript" src="js/.jquery.js"></script>
<script type="text/javascript" src="js/.jquery-ui.js"></script>
<script type="text/javascript" src="js/.sortable.js"></script>
<script type="text/javascript" src="js/.layout.js"></script>
<script type="text/javascript" src="js/.breadcrumb.js"></script>
<script type="text/javascript">
var layout, westLayout, centerLayout;
$(document).ready(function () {
  if ($("#north-bread-crumb")) {
    $("#north-bread-crumb").jBreadCrumb({easing:'swing'})
  }
  layout = $("body").layout({ 
    resizable: true,
    spacing_open: 4,
    spacing_closed: 4,
    north: {
      size: 76
    },
    south: {
      size: 45,
      initClosed: true
    },
    west: {
      size: 500,
      resizable: true,
      initClosed: false
    }
  });
  centerLayout = $('div.ui-layout-center').layout({
    north__paneSelector: ".ui-layout-center-inner-north",
    center__paneSelector: ".ui-layout-center-inner-center", 
    north__size: 50,
    spacing_open: 4,
    spacing_closed: 4
  });
});
</script>
</head>
<body onLoad="initPage();"><div class="ui-layout-north">
<div class="logo"></div>
<center class="pagetitle">Module Definition</center>
<div align="center"><a href="dashboard.html" ><b>dashboard</b></a> | <a href="hierarchy.html" ><b>hierarchy</b></a> | <a href="modlist.html" ><b>modlist</b></a> | groups | <a href="tests.html" ><b>tests</b></a> | asserts</div>

</div>
<div class="ui-layout-west">
<div name='tag_tb_frame_detector'>
<div class=modhdr>
<br clear=all>
<span class=titlename>Module : <a href="#"  onclick="showContent('tag_tb_frame_detector')">tb_frame_detector</a></span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>BRANCH</td></tr><tr>
<td class="s7 cl rt"> 73.21</td>
<td class="s9 cl rt"><a href="mod5.html#Line" > 94.79</a></td>
<td class="wht cl rt"></td>
<td class="s4 cl rt"><a href="mod5.html#Toggle" > 49.85</a></td>
<td class="s7 cl rt"><a href="mod5.html#Branch" > 75.00</a></td>
</tr></table><br clear=all>
<span class=repname>Source File(s) : </span>
<br clear=all>
<a href="javascript:void(0);"  onclick="openSrcFile('/home/ray/git/chaoslogic/verification/tb.sv')">/home/ray/git/chaoslogic/verification/tb.sv</a><br clear=all>
<br clear=all>
<span class=repname>Module self-instances :</span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td class="alfsrt">NAME</td><td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>BRANCH</td></tr><tr>
<td class="wht cl wordwrap"><a href="mod5.html#inst_tag_5"  onclick="showContent('inst_tag_5')">tb_frame_detector</a></td>
<td class="s7 cl rt"> 73.21</td>
<td class="s9 cl rt"><a href="mod5.html#Line" > 94.79</a></td>
<td class="wht cl rt"></td>
<td class="s4 cl rt"><a href="mod5.html#Toggle" > 49.85</a></td>
<td class="s7 cl rt"><a href="mod5.html#Branch" > 75.00</a></td>
</tr></table></div>
</div>
<br clear=all>
<div name='tag_tb_frame_detector'>
<hr>
<a name="inst_tag_5"></a>
<div class=modhdr>
<br clear=all>
<span class=titlename>Module Instance : <a href="hierarchy.html#tag_urg_inst_5" >tb_frame_detector</a></span>
<br clear=all>
<br clear=all>
<span class=repname>Instance :</span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>BRANCH</td></tr><tr>
<td class="s7 cl rt"> 73.21</td>
<td class="s9 cl rt"><a href="mod5.html#Line" > 94.79</a></td>
<td class="wht cl rt"></td>
<td class="s4 cl rt"><a href="mod5.html#Toggle" > 49.85</a></td>
<td class="s7 cl rt"><a href="mod5.html#Branch" > 75.00</a></td>
</tr></table><br clear=all>
<br clear=all>
<span class=repname>Instance's subtree :</span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>BRANCH</td></tr><tr>
<td class="s9 cl rt"> 90.96</td>
<td class="s9 cl rt"> 96.30</td>
<td class="s8 cl rt"> 86.21</td>
<td class="s8 cl rt"> 89.16</td>
<td class="s9 cl rt"> 92.19</td>
</tr></table><br clear=all>
<br clear=all>
<span class=repname>Parent : </span>
<br clear=all>
<span class=inst>none</span>
<br clear=all>
<br clear=all>
<span class=repname>Subtrees :</span>
<br clear=all>
<table align=left>
<tr class="sortablehead">
<td class="alfsrt">NAME</td><td>SCORE</td><td>LINE</td><td>COND</td><td>TOGGLE</td><td>BRANCH</td></tr><tr>
<td class="wht cl wordwrap"><a href="mod6.html#inst_tag_6" id="tag_urg_inst_6">dut</a></td>
<td class="s9 cl rt"> 93.29</td>
<td class="s9 cl rt"> 99.05</td>
<td class="s8 cl rt"> 86.21</td>
<td class="s9 cl rt"> 94.57</td>
<td class="s9 cl rt"> 93.33</td>
</tr></table><br clear=all>
</div>
</div>
<hr>
Since this is the module's only instance, the coverage report is the same as for the module.</div>
<div class="ui-layout-center">
<div class="ui-layout-center-inner-center">
<div name='tag_tb_frame_detector'>
<a name="Line"></a>
Line Coverage for Module : <a href="mod5.html" >tb_frame_detector</a><br clear=all>
<table class="noborder">
<col width="122">
<col span="4" width="82">
<tr><th></th><th>Line No.</th><th>Total</th><th>Covered</th><th>Percent</th></tr>
<tr class="s9"><td class="lf">TOTAL</td><td></td><td>192</td><td>182</td><td>94.79</td></tr>
<tr class="s10"><td class="lf">INITIAL</td><td>60</td><td>4</td><td>4</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">INITIAL</td><td>65</td><td>6</td><td>6</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">INITIAL</td><td>71</td><td>6</td><td>6</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">ROUTINE</td><td>78</td><td>1</td><td>1</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">ROUTINE</td><td>90</td><td>24</td><td>24</td><td>100.00</td></tr>
<tr class="s8"><td class="lf">ROUTINE</td><td>130</td><td>37</td><td>33</td><td>89.19</td></tr>
<tr class="s9"><td class="lf">INITIAL</td><td>177</td><td>38</td><td>37</td><td>97.37</td></tr>
<tr class="s10"><td class="lf">ROUTINE</td><td>244</td><td>25</td><td>25</td><td>100.00</td></tr>
<tr class="s9"><td class="lf">ROUTINE</td><td>279</td><td>10</td><td>9</td><td>90.00</td></tr>
<tr class="s10"><td class="lf">ROUTINE</td><td>296</td><td>21</td><td>21</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">ROUTINE</td><td>329</td><td>7</td><td>7</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">ROUTINE</td><td>347</td><td>4</td><td>4</td><td>100.00</td></tr>
<tr class="s10"><td class="lf">ALWAYS</td><td>358</td><td>2</td><td>2</td><td>100.00</td></tr>
<tr class="s2"><td class="lf">INITIAL</td><td>362</td><td>5</td><td>1</td><td>20.00</td></tr>
<tr class="s10"><td class="lf">INITIAL</td><td>378</td><td>2</td><td>2</td><td>100.00</td></tr>
</table>
<pre class="code"><br clear=all>
59                      initial begin
60         1/1              clk_in = 0;
61         3/3              forever #(CLK_PERIOD_IN/2) clk_in = ~clk_in;
62                      end
63                      
64                      initial begin
65         2/2              #8;
66         1/1              clk_out = 0;
67         3/3              forever #(CLK_PERIOD_OUT/2) clk_out = ~clk_out;
68                      end
69                      
70                      initial begin
71         2/2              #8;
72         1/1              clk_out_s = 0;
73         3/3              forever #(CLK_PERIOD_S/2) clk_out_s = ~clk_out_s;
74                      end
75                      
76                      // 二进制到格雷码转换函数
77                      function automatic logic [127:0] bin2gray(input [127:0] bin);
78         1/1              return bin ^ (bin &gt;&gt; 1);
79                      endfunction
80                      
81                      // 测试任务：发送完整帧
82                      task send_frame;
83                          input [7:0]  channel;     // 通道选择 (独热码)
84                          input [127:0] data;        // 数据负载 (最大128位)
85                          input [15:0]  data_len;    // 数据长度 (16-128位)
86                          input [15:0]  crc;         // CRC校验值
87                          
88                          // 发送帧头
89                          //data_in = 0;  //fix me
90         2/2              @(posedge clk_in);
91         1/1              data_in = HEADER[31:16];
92         2/2              @(posedge clk_in);
93         1/1              data_in = HEADER[15:0];
94         2/2              @(posedge clk_in);
95                          
96                          // 发送通道选择
97         1/1              data_in = {8'b0, channel};
98         2/2              @(posedge clk_in);
99                          
100                         // 发送数据
101        1/1              for (int i = 0; i &lt; data_len; i += 16) begin
102        1/1                  data_in = data[(data_len-i-1) -: 16]; // Big-Endian顺序
103        2/2                  @(posedge clk_in);
104                         end
105                         
106                         // 发送CRC
107        1/1              data_in = crc;
108        2/2              @(posedge clk_in);
109                         
110                         // 发送帧尾
111        1/1              data_in = TRAILER[31:16];
112        2/2              @(posedge clk_in);
113        1/1              data_in = TRAILER[15:0];
114        2/2              @(posedge clk_in);
115                         //data_in = 0;  //fix me
116                         //@(posedge clk_in);
117                     endtask
118                     
119                     // 测试任务：检查串行输出
120                     task check_serial_output;
121                         input [3:0] channel;          // 通道号 (1-8)
122                         input [127:0] exp_data; // 预期数据
123                         input [15:0] data_len;  // 数据长度
124                     
125                         logic [127:0] exp_gray;
126                         
127                         logic data_vld;
128                         logic data_out;
129                     
130        1/1              automatic logic error_flag = 0;
131                         // 等待有效信号
132                         fork
133        2/2                  wait(crc_valid === 1'b1);
134        2/2                  #128;
135                         join_any
136        1/1              if (crc_valid === 1'b1)begin
137        1/1                  $display(&quot;[%0t ps] CH%d 数据输出开始&quot;, $time, channel);
138        1/1                  exp_gray = bin2gray(exp_data[127:0]);
139        2/2                  #1;
140                             // 收集串行数据 (修复循环变量冲突) 
141        1/1                  for (int bit_idx = data_len - 1; bit_idx &gt;= 0; bit_idx--) begin
142        1/1                      case(channel)
143        2/2                          4'd1: begin data_vld = data_vld_ch1; data_out = data_out_ch1; end
144        2/2                          4'd2: begin data_vld = data_vld_ch2; data_out = data_out_ch2; end
145        2/2                          4'd3: begin data_vld = data_vld_ch3; data_out = data_out_ch3; end
146        2/2                          4'd4: begin data_vld = data_vld_ch4; data_out = data_out_ch4; end
147        2/2                          4'd5: begin data_vld = data_vld_ch5; data_out = data_out_ch5; end
148        2/2                          4'd6: begin data_vld = data_vld_ch6; data_out = data_out_ch6; end
149        2/2                          4'd7: begin data_vld = data_vld_ch7; data_out = data_out_ch7; end
150        2/2                          4'd8: begin data_vld = data_vld_ch8; data_out = data_out_ch8; end
                   <font color = "red">==>  MISSING_DEFAULT</font>
151                                 endcase
152        1/1                      if (exp_gray[bit_idx] != data_out) begin
153        <font color = "red">0/1     ==>                  $error(&quot;[%0t ps] CH%d 数据不匹配! 位 %0d: 预期=%h, 实际=%h&quot;, </font>
154                                         $time, channel, bit_idx, exp_gray[bit_idx], data_out);
155        <font color = "red">0/1     ==>                  error_flag = 1;</font>
156                                 end
                        MISSING_ELSE
157        2/2                      #CLK_PERIOD_S;
158                             end
159        1/1                  if (~error_flag) begin
160        1/1                      $display(&quot;[%0t ps] CH%d 数据验证通过, %0d 位数据正确&quot;, $time, channel, data_len);
161                             end else begin
162        <font color = "red">0/1     ==>              $error(&quot;[%0t ps] CH%d 数据验证失败, %0d 位数据错误&quot;, $time, channel, data_len);</font>
163                             end
164                         end else begin
165        <font color = "red">0/1     ==>          $error(&quot;[%0t ps] CH%d CRC错误, 无法验证数据&quot;, $time, channel);</font>
166                         end
167                     endtask
168                     
169                     logic [3:0] rand_channel;
170                     logic [7:0] single_channel;
171                     logic [127:0] rand_data;
172                     logic [15:0] rand_len;
173                     logic [127:0] sent_data;
174                     // 主测试流程
175                     initial begin
176                         // 初始化
177        1/1              $display(&quot;\n===== init =====&quot;);
178        1/1              data_in = 0;
179        1/1              rst_n = 0;
180        2/2              #100;
181        1/1              rst_n = 1;
182        2/2              #100;
183                         
184        1/1              $display(&quot;\n===== 测试1: 基本功能测试 (16、32、48位数据) =====&quot;);
185        1/1                  test_single_frame(8'b0000_0001, 128'h0000_0000_0000_0000_0000_0000_0000_A55A, 16);
186                             fork 
187        1/1                      check_output(8'b0000_0001, 128'h0000_0000_0000_0000_0000_0000_0000_A55A, 16);
188        1/1                      test_single_frame(8'b0000_0001, 128'h0000_0000_0000_0000_0000_0000_1111_A55A, 32);
189                             join
190                     
191                             fork
192        1/1                      check_output(8'b0000_0001, 128'h0000_0000_0000_0000_0000_0000_1111_A55A, 32);
193                      
194        1/1                      $display(&quot;\n===== 测试2: 最大长度测试 (128位数据) =====&quot;);
195        1/1                      test_single_frame(8'b0000_0010, 128'h0123456789ABCDEFFEDCBA9876543210, 128);
196                             join
197                     
198                             fork
199        1/1                      check_output(8'b0000_0010, 128'h0123456789ABCDEFFEDCBA9876543210, 128);
200                     
201        1/1                      $display(&quot;\n===== 测试3: 边界长度测试 =====&quot;);
202        1/1                      test_single_frame(8'b0000_0100, 128'h1234, 16);  // 最小长度
203                             join
204                     
205                             fork
206        1/1                      check_output(8'b0000_0100, 128'h1234, 16);
207                     
208        1/1                      test_single_frame(8'b0001_0000, 128'hA5A5A5A5A5A5A5A5A5A5A5A5A5A5A5A5, 128); // 最大长度
209                             join
210        1/1                  check_output(8'b0001_0000, 128'hA5A5A5A5A5A5A5A5A5A5A5A5A5A5A5A5, 128);
211                     
212                         // 大规模随机测试
213        1/1              $display(&quot;\n===== 测试4: 大规模随机测试 =====&quot;);
214        1/1              $display(&quot;[%0t ps] 进行第 1 次随机测试&quot;, $time);
215        1/1              test_rand_frame(single_channel, sent_data, rand_len);
216                         
217        1/1              for (int i = 1; i &lt; 20000; i++) begin
218                             fork
219        1/1                      check_output(single_channel, sent_data, rand_len);
220        1/1                      $display(&quot;[%0t ps] 进行第 %0d 次随机测试&quot;, $time, i+1);
221        1/1                      test_rand_frame(single_channel, sent_data, rand_len);
222                             join
223                         end 
224                     
225                         // 添加错误测试
226        1/1              $display(&quot;\n===== 测试5: CRC错误测试 =====&quot;);
227        1/1              send_frame(8'b0000_0001, 128'h0000_0000_0000_0000_0000_0000_0000_1234, 16, 16'hFFFF); // 错误CRC
228        2/2              wait(crc_err === 1'b1);
229        1/1              $display(&quot;crc_err验证通过&quot;);
230        <font color = "red">1/2     ==>      if(data_vld_ch1 !== 0) $error(&quot;CRC错误时不应有有效输出&quot;);</font>
                        MISSING_ELSE
231                     
232                         
233                         //超长数据测试
234        1/1              send_oversize_frame(8'b0010_0000,{128{2'b10}}, 16'h1145);
235        1/1              $display(&quot;\n===== 所有测试结束 =====&quot;);
236        1/1              $finish;
237                     end
238                     // 测试任务：发送超长帧
239                     task send_oversize_frame;
240                         input [7:0]  channel;     // 通道选择 (独热码)
241                         input [255:0] data;        // 数据负载 (最大128位)
242                         input [15:0]  crc;         // CRC校验值
243                         
244        1/1              automatic logic [31:0] data_len = 32'd256;
245                         // 发送帧头
246                         //data_in = 0;  //fix me
247        2/2              @(posedge clk_in);
248        1/1              data_in = HEADER[31:16];
249        2/2              @(posedge clk_in);
250        1/1              data_in = HEADER[15:0];
251        2/2              @(posedge clk_in);
252                         
253                         // 发送通道选择
254        1/1              data_in = {8'b0, channel};
255        2/2              @(posedge clk_in);
256                         
257                         // 发送数据
258        1/1              for (int i = 0; i &lt; data_len; i += 16) begin
259        1/1                  data_in = data[(data_len-i-1) -: 16]; // Big-Endian顺序
260        2/2                  @(posedge clk_in);
261                         end
262                         
263                         // 发送CRC
264        1/1              data_in = crc;
265        2/2              @(posedge clk_in);
266                         
267                         // 发送帧尾
268        1/1              data_in = TRAILER[31:16];
269        2/2              @(posedge clk_in);
270        1/1              data_in = TRAILER[15:0];
271        2/2              @(posedge clk_in);
272                         //data_in = 0;  //fix me
273                         //@(posedge clk_in);
274                     endtask
275                     
276                     task automatic test_rand_frame(ref logic [7:0] single_channel, ref logic [127:0] sent_data, ref logic [15:0] rand_len);
277                         logic [7:0] rand_channel;
278                         logic [127:0] rand_data;
279        1/1              rand_channel = $urandom() &gt;&gt; (32 - 8); // 生成随机通道
280        1/1              single_channel = 1'b1 &lt;&lt; (rand_channel % 8); // 独热码
281        1/1              rand_data = {$urandom(), $urandom(), $urandom(), $urandom()}; // 生成随机数据
282        1/1              rand_len = ($urandom()&gt;&gt; (32-3)) * 16; // 随机长度 (16-128位,16的倍数)
283        2/2              if (rand_len &lt; 16) rand_len = 16; // 确保最小长度为16位
                        MISSING_ELSE
284        <font color = "red">1/2     ==>      if (rand_len &gt; 128) rand_len = 128; // 确保最大长度为128位</font>
                        MISSING_ELSE
285        1/1              sent_data = rand_data &gt;&gt; (128 - rand_len); // 截断数据到指定长度
286        1/1              test_single_frame(single_channel, sent_data, rand_len);
287                     endtask : test_rand_frame
288                     
289                     
290                     task automatic crc16_ccitt(
291                         input  logic [127:0] data,
292                         output logic [15:0] crc_value
293                     );
294                         reg [15:0] data_to_crc;
295                         reg [15:0] lfsr_q,lfsr_c;
296        1/1              lfsr_q = 0;
297                     
298                         // 逐位处理 128 位输入数据
299                     
300        1/1              for (int i = 127; i &gt; 0; i-=16) begin
301        1/1                  data_to_crc = data[(i-15)+:16];
302        1/1                  lfsr_c[0] = lfsr_q[0] ^ lfsr_q[4] ^ lfsr_q[8] ^ lfsr_q[11] ^ lfsr_q[12] ^ data_to_crc[0] ^ data_to_crc[4] ^ data_to_crc[8] ^ data_to_crc[11] ^ data_to_crc[12];
303        1/1                  lfsr_c[1] = lfsr_q[1] ^ lfsr_q[5] ^ lfsr_q[9] ^ lfsr_q[12] ^ lfsr_q[13] ^ data_to_crc[1] ^ data_to_crc[5] ^ data_to_crc[9] ^ data_to_crc[12] ^ data_to_crc[13];
304        1/1                  lfsr_c[2] = lfsr_q[2] ^ lfsr_q[6] ^ lfsr_q[10] ^ lfsr_q[13] ^ lfsr_q[14] ^ data_to_crc[2] ^ data_to_crc[6] ^ data_to_crc[10] ^ data_to_crc[13] ^ data_to_crc[14];
305        1/1                  lfsr_c[3] = lfsr_q[3] ^ lfsr_q[7] ^ lfsr_q[11] ^ lfsr_q[14] ^ lfsr_q[15] ^ data_to_crc[3] ^ data_to_crc[7] ^ data_to_crc[11] ^ data_to_crc[14] ^ data_to_crc[15];
306        1/1                  lfsr_c[4] = lfsr_q[4] ^ lfsr_q[8] ^ lfsr_q[12] ^ lfsr_q[15] ^ data_to_crc[4] ^ data_to_crc[8] ^ data_to_crc[12] ^ data_to_crc[15];
307        1/1                  lfsr_c[5] = lfsr_q[0] ^ lfsr_q[4] ^ lfsr_q[5] ^ lfsr_q[8] ^ lfsr_q[9] ^ lfsr_q[11] ^ lfsr_q[12] ^ lfsr_q[13] ^ data_to_crc[0] ^ data_to_crc[4] ^ data_to_crc[5] ^ data_to_crc[8] ^ data_to_crc[9] ^ data_to_crc[11] ^ data_to_crc[12] ^ data_to_crc[13];
308        1/1                  lfsr_c[6] = lfsr_q[1] ^ lfsr_q[5] ^ lfsr_q[6] ^ lfsr_q[9] ^ lfsr_q[10] ^ lfsr_q[12] ^ lfsr_q[13] ^ lfsr_q[14] ^ data_to_crc[1] ^ data_to_crc[5] ^ data_to_crc[6] ^ data_to_crc[9] ^ data_to_crc[10] ^ data_to_crc[12] ^ data_to_crc[13] ^ data_to_crc[14];
309        1/1                  lfsr_c[7] = lfsr_q[2] ^ lfsr_q[6] ^ lfsr_q[7] ^ lfsr_q[10] ^ lfsr_q[11] ^ lfsr_q[13] ^ lfsr_q[14] ^ lfsr_q[15] ^ data_to_crc[2] ^ data_to_crc[6] ^ data_to_crc[7] ^ data_to_crc[10] ^ data_to_crc[11] ^ data_to_crc[13] ^ data_to_crc[14] ^ data_to_crc[15];
310        1/1                  lfsr_c[8] = lfsr_q[3] ^ lfsr_q[7] ^ lfsr_q[8] ^ lfsr_q[11] ^ lfsr_q[12] ^ lfsr_q[14] ^ lfsr_q[15] ^ data_to_crc[3] ^ data_to_crc[7] ^ data_to_crc[8] ^ data_to_crc[11] ^ data_to_crc[12] ^ data_to_crc[14] ^ data_to_crc[15];
311        1/1                  lfsr_c[9] = lfsr_q[4] ^ lfsr_q[8] ^ lfsr_q[9] ^ lfsr_q[12] ^ lfsr_q[13] ^ lfsr_q[15] ^ data_to_crc[4] ^ data_to_crc[8] ^ data_to_crc[9] ^ data_to_crc[12] ^ data_to_crc[13] ^ data_to_crc[15];
312        1/1                  lfsr_c[10] = lfsr_q[5] ^ lfsr_q[9] ^ lfsr_q[10] ^ lfsr_q[13] ^ lfsr_q[14] ^ data_to_crc[5] ^ data_to_crc[9] ^ data_to_crc[10] ^ data_to_crc[13] ^ data_to_crc[14];
313        1/1                  lfsr_c[11] = lfsr_q[6] ^ lfsr_q[10] ^ lfsr_q[11] ^ lfsr_q[14] ^ lfsr_q[15] ^ data_to_crc[6] ^ data_to_crc[10] ^ data_to_crc[11] ^ data_to_crc[14] ^ data_to_crc[15];
314        1/1                  lfsr_c[12] = lfsr_q[0] ^ lfsr_q[4] ^ lfsr_q[7] ^ lfsr_q[8] ^ lfsr_q[15] ^ data_to_crc[0] ^ data_to_crc[4] ^ data_to_crc[7] ^ data_to_crc[8] ^ data_to_crc[15];
315        1/1                  lfsr_c[13] = lfsr_q[1] ^ lfsr_q[5] ^ lfsr_q[8] ^ lfsr_q[9] ^ data_to_crc[1] ^ data_to_crc[5] ^ data_to_crc[8] ^ data_to_crc[9];
316        1/1                  lfsr_c[14] = lfsr_q[2] ^ lfsr_q[6] ^ lfsr_q[9] ^ lfsr_q[10] ^ data_to_crc[2] ^ data_to_crc[6] ^ data_to_crc[9] ^ data_to_crc[10];
317        1/1                  lfsr_c[15] = lfsr_q[3] ^ lfsr_q[7] ^ lfsr_q[10] ^ lfsr_q[11] ^ data_to_crc[3] ^ data_to_crc[7] ^ data_to_crc[10] ^ data_to_crc[11];
318        1/1                  lfsr_q = lfsr_c;
319                         end
320        1/1              crc_value = lfsr_c;
321                     endtask
322                     
323                     // 测试单个帧的任务
324                     task test_single_frame;
325                         input [7:0]  channel;
326                         input [127:0] data;
327                         input [15:0] data_len;
328                         
329        1/1              automatic logic [15:0] crc_value = 16'h0000;
330                     
331        1/1              crc16_ccitt(data,crc_value); // 计算CRC值
332        1/1              $display(&quot;[%0t ps] tb计算CRC: %h&quot;, $time, crc_value);
333                         // 发送帧
334        1/1              $display(&quot;[%0t ps] 发送帧: 通道=%b, 长度=%0d&quot;, $time, channel, data_len);
335        1/1              $display(&quot;[%0t ps] 发送数据: %h&quot;, $time, data);
336        1/1              $display(&quot;[%0t ps] 发送CRC: %h&quot;, $time, crc_value);
337                         // 发送帧
338        1/1              send_frame(channel, data, data_len, crc_value);
339                     endtask
340                     
341                     
342                     task check_output ;
343                         input [7:0]  channel;
344                         input [127:0] data;
345                         input [15:0] data_len;
346                     // 检查输出
347        1/1              for (int ch = 1; ch &lt;= 8; ch++) begin
348        1/1                  if (channel[ch-1]) begin
349        1/1                      $display(&quot;[%0t ps] 检查CH%d输出&quot;, $time, ch);
350        1/1                      check_serial_output(ch, data, data_len);
351                             end
                        MISSING_ELSE
352                         end
353                     
354                     endtask
355                     
356                     // 监控错误信号
357                     always @(posedge clk_in) begin
358        2/2              if (crc_err) $warning(&quot;[%0t ps] CRC错误检测&quot;, $time);
                        MISSING_ELSE
359                     end
360                     
361                     initial begin
362        <font color = "red">1/2     ==>      #100000000;</font>
363        <font color = "red">0/1     ==>      $dumpflush;</font>
364        <font color = "red">0/1     ==>      $error(&quot;仿真超时&quot;);</font>
365        <font color = "red">0/1     ==>      $finish;</font>
366                     end
367                     
368                     
369                     //fsdb dump 
370                     // initial begin
371                     //     $fsdbDumpfile(&quot;wave.fsdb&quot;);
372                     //     $fsdbDumpvars(0, tb_frame_detector, &quot;+all&quot;);
373                     //     $fsdbDumpMDA();
374                     // end
375                     
376                     //vcd dump
377                     initial begin
378        1/1              $dumpfile(&quot;wave.vcd&quot;);
379        1/1              $dumpvars(0, tb_frame_detector);
</pre>
<hr>
<a name="Toggle"></a>
Toggle Coverage for Module : <a href="mod5.html" >tb_frame_detector</a><br clear=all>
<table align=left class="noborder">
<tr>
<th nowrap width=120></th><th nowrap width=80>Total</th><th nowrap width=80>Covered</th><th nowrap width=80>Percent</th></tr><tr class="s8">
<td>Totals</td>
<td class="rt">30</td>
<td class="rt">24</td>
<td class="rt">80.00 </td>
</tr><tr class="s4">
<td>Total Bits</td>
<td class="rt">648</td>
<td class="rt">323</td>
<td class="rt">49.85 </td>
</tr><tr class="s5">
<td nowrap>Total Bits 0->1</td>
<td class="rt">324</td>
<td class="rt">162</td>
<td class="rt">50.00 </td>
</tr><tr class="s4">
<td nowrap>Total Bits 1->0</td>
<td class="rt">324</td>
<td class="rt">161</td>
<td class="rt">49.69 </td>
</tr></table><br clear=all>
<table align=left class="noborder">
<tr>
<th nowrap width=120></th><th nowrap width=80></th><th nowrap width=80></th><th nowrap width=80></th></tr><tr class="s8">
<td>Signals</td>
<td class="rt">30</td>
<td class="rt">24</td>
<td class="rt">80.00 </td>
</tr><tr class="s4">
<td>Signal Bits</td>
<td class="rt">648</td>
<td class="rt">323</td>
<td class="rt">49.85 </td>
</tr><tr class="s5">
<td nowrap>Signal Bits 0->1</td>
<td class="rt">324</td>
<td class="rt">162</td>
<td class="rt">50.00 </td>
</tr><tr class="s4">
<td nowrap>Signal Bits 1->0</td>
<td class="rt">324</td>
<td class="rt">161</td>
<td class="rt">49.69 </td>
</tr></table><br clear=all>
<table align=left class="sortable noborder">
<caption><b>Signal Details</b></caption>
<tr class="sortablehead">
<td class="alfsrt">Name</td><td class="alfsrt">Toggle</td><td class="alfsrt">Toggle 1->0</td><td class="alfsrt">Toggle 0->1</td></tr><tr>
<td>clk_in</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>clk_out</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>clk_out_s</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>rst_n</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_in[15:0]</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch1</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch2</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch3</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch4</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch5</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch6</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch7</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_out_ch8</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch1</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch2</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch3</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch4</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch5</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch6</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch7</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>data_vld_ch8</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>crc_valid</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>crc_err</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>fifo_empty</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>fifo_full</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
</tr><tr>
<td>rand_channel[3:0]</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
</tr><tr>
<td>single_channel[7:0]</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>rand_data[127:0]</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
</tr><tr>
<td>rand_len[3:0]</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
</tr><tr>
<td>rand_len[6:4]</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>rand_len[15:7]</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
</tr><tr>
<td>sent_data[111:0]</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
<td class="s9 cl">Yes</td>
</tr><tr>
<td>sent_data[127:112]</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
<td class="s3 cl">No</td>
</tr></table><br clear=all>
<hr>
<a name="Branch"></a>
Branch Coverage for Module : <a href="mod5.html" >tb_frame_detector</a><br clear=all>
<table align=left class="noborder">
<tr>
<th nowrap width=120></th><th nowrap width=80>Line No.</th><th nowrap width=80>Total</th><th nowrap width=80>Covered</th><th nowrap width=80>Percent</th></tr><tr class="s7">
<td>Branches</td>
<td></td>
<td class="rt">4</td>
<td class="rt">3</td>
<td class="rt">75.00 </td>
</tr><tr class="s5">
<td>IF</td>
<td class="rt">230</td>
<td class="rt">2</td>
<td class="rt">1</td>
<td class="rt">50.00 </td>
</tr><tr class="s10">
<td>IF</td>
<td class="rt">358</td>
<td class="rt">2</td>
<td class="rt">2</td>
<td class="rt">100.00</td>
</tr></table><br clear=all>
<pre class="code"><br clear=all>
230            if(data_vld_ch1 !== 0) $error("CRC错误时不应有有效输出");
               <font color = "red">-1-</font>  
           <font color = "red">    ==></font>
               MISSING_ELSE
           <font color = "green">    ==></font>
</pre>
<br clear=all>
<span class=repname>Branches:</span>
<br clear=all>
<table align=left class="noborder">
<tr>
<th nowrap width=80>-1-</th><th nowrap width=80>Status</th></tr><tr class="uRed">
<td align=center>1</td>
<td>Not Covered</td>
</tr><tr class="uGreen">
<td align=center>0</td>
<td>Covered</td>
</tr></table><br clear=all>
<pre class="code"><br clear=all>
358            if (crc_err) $warning("[%0t ps] CRC错误检测", $time);
               <font color = "green">-1-</font>  
           <font color = "green">    ==></font>
               MISSING_ELSE
           <font color = "green">    ==></font>
</pre>
<br clear=all>
<span class=repname>Branches:</span>
<br clear=all>
<table align=left class="noborder">
<tr>
<th nowrap width=80>-1-</th><th nowrap width=80>Status</th></tr><tr class="uGreen">
<td align=center>1</td>
<td>Covered</td>
</tr><tr class="uGreen">
<td align=center>0</td>
<td>Covered</td>
</tr></table><br clear=all>
</div>
</div>
<div class="ui-layout-center-inner-north">
<div id="center-bread-crumb" class="breadCrumb module urg-margin-bottom">
  <ul name="inst_tag_5">
    <li>
      <a href="#Line">Line</a>    </li>
    <li>
      <a href="#Toggle">Toggle</a>    </li>
    <li>
      <a href="#Branch">Branch</a>    </li>
  </ul>
  <ul name="tag_tb_frame_detector">
    <li>
      <a href="#Line">Line</a>    </li>
    <li>
      <a href="#Toggle">Toggle</a>    </li>
    <li>
      <a href="#Branch">Branch</a>    </li>
  </ul>
</div>
</div>
</div>
<div class="ui-layout-south">
<table align=center><tr><td class="s0 cl">0%</td>
<td class="s1 cl">10%</td>
<td class="s2 cl">20%</td>
<td class="s3 cl">30%</td>
<td class="s4 cl">40%</td>
<td class="s5 cl">50%</td>
<td class="s6 cl">60%</td>
<td class="s7 cl">70%</td>
<td class="s8 cl">80%</td>
<td class="s9 cl">90%</td>
<td class="s10 cl">100%</td></tr></table></div>
</body>
</html>
